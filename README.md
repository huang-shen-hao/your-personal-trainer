私人教练 AI — PRD v1.1（Vue 3，本地数据&本地AI优先）
版本：v1.1（修订版）
负责人：[huangshenhao]
发布日期：2025-11-11
最后更新：2025-11-11

## 1. 项目概述

### 1.1 目标
在完全本地（离线优先）的前端应用中，提供"私人教练"式健身指导：
- **核心交互**：文字对话 + 图片拍摄上传分析
- **智能识别**：AI 视觉识别（饮食分析、体态评估、器械识别）
- **个性化计划**：基于用户档案生成并迭代健身计划
- **数据记录**：手动/半自动训练记录与进度追踪

### 1.2 平台与架构
- **前端框架**：Vue 3 + Vite（PWA 优先；移动端打包可选）
- **数据策略**：全部数据本地保存（IndexedDB / File System Access / LocalStorage），训练记录与用户档案不上传
- **AI 策略**：
  - **通用大模型 API**：接入 OpenAI / Claude / 国内大模型（deepseek、通义千问、文心一言、Kimi 等）
  - **专业化方案**：通过精心设计的 System Prompt 实现私人教练专业性
  - **多模态能力**：优先选择支持图文混合对话的模型（GPT-4 Vision / Claude 3 / 通义千问-VL 等）
  - **隐私保护**：用户可选择自带 API Key，图片分析结果仅在会话中使用

### 1.3 范围界定
**包含**：
- 文字对话与智能问答
- 图片拍摄/上传与 AI 视觉分析
- 训练计划生成与调整
- 手动训练记录与数据统计
- 进度可视化与周报

**不包含**：
- 医疗诊断与营养处方（仅提供通用建议 + 免责声明）
- 实时视频姿态识别与动作计数
- 语音输入/输出功能
- 社交功能、云同步（可后续选配）
## 2. 用户与场景

### 2.1 目标用户
- **主要用户**：想要在家/健身房获得入门到中级训练计划的健身爱好者
- **用户特征**：重视隐私保护、需要离线可用、希望获得个性化指导
- **痛点**：
  - 不知道如何制定科学的训练计划
  - 不确定自己的饮食是否合理
  - 担心体态/动作问题但缺乏专业反馈
  - 不愿将个人数据上传云端

### 2.2 关键场景

#### 场景 1：首次使用
1. 填写基础信息（身高、体重、经验、器械条件、目标等）
2. 选择教练性格预设（严厉/鼓励/幽默/学术派）
3. AI 生成 4-8 周个性化训练计划
4. 浏览计划详情，了解动作要点

#### 场景 2：训练执行与记录
1. 打开今日训练计划
2. 完成动作后手动记录：组数、次数、重量、RPE（主观用力感）
3. 可拍摄器械/动作照片，AI 识别并给出动作要点提示
4. 训练结束后填写整体感受（疲劳度、疼痛部位等）

#### 场景 3：饮食拍照咨询
1. 拍摄餐食照片上传
2. AI 识别食物种类与大致热量
3. 给出营养建议（如：蛋白质占比、热量估算、建议调整）
4. 提供免责声明：建议仅供参考，非医疗/营养处方

#### 场景 4：体态评估
1. 拍摄全身/局部体态照片（正面/侧面/背面）
2. AI 识别体态问题（如：圆肩、骨盆前倾、高低肩等）
3. 给出改善建议与针对性拉伸/强化动作
4. 记录到档案中，可定期对比进度

#### 场景 5：进度复盘
1. 查看周报：训练次数、总训练量（Tonnage）、体重变化
2. 查看进度曲线：力量增长、体围变化、体脂变化
3. AI 根据完成度与 RPE 数据自动生成下周计划调整建议
4. 用户确认后应用调整

#### 场景 6：日常问答
1. 文字对话询问动作要点、器械替代方案、训练技巧等
2. 可附带图片（如：器械照片、动作示意图）
3. AI 提供详细解答与建议
## 3. 目标与指标（KPI）

### 3.1 用户激活与留存
- **首周激活**：≥90% 用户完成基础信息填写与首份训练计划生成
- **计划执行**：≥70% 用户完成首周≥2次训练记录
- **图片功能使用**：≥50% 用户在首月内至少使用1次图片分析功能
- **周留存**：≥60% 用户在第二周继续使用

### 3.2 性能指标
- **冷启动时间**：< 2.5s（不含首次模型下载）
- **对话响应**：< 1.5s（纯文本，模型已加载）
- **图片分析**：< 5s（单张图片，含模型推理时间）
- **模型下载**：
  - 基础 LLM 模型：< 500MB
  - 视觉模型：< 200MB
  - 支持断点续传与分块下载

### 3.3 准确性与质量
- **饮食识别**：主要食物识别准确率 ≥ 85%（Top-3）
- **体态评估**：关键体态问题识别率 ≥ 75%（常见问题如圆肩、骨盆前倾等）
- **对话质量**：用户满意度 ≥ 4.0/5.0（主观评分）
- **计划合理性**：遵循运动科学原则，无明显危险建议
## 4. 功能需求

### 4.1 对话与图片分析

#### 4.1.1 文本对话
- **聊天界面**：类 ChatGPT 风格，支持多轮对话
- **消息格式**：支持 Markdown 渲染（代码块、列表、表格、加粗等）
- **对话类型**：
  - 健身计划咨询
  - 动作技巧讲解
  - 器械使用与替代方案
  - 训练疑问解答
  - 进度分析与建议

#### 4.1.2 图片上传与分析
- **拍摄/上传**：
  - 支持相机拍摄（前置/后置）
  - 支持相册选择
  - 支持拖拽上传（桌面端）
  - 单次支持 1-4 张图片
  
- **分析类型**：
  
  **A. 饮食分析**
  - 识别食物种类与数量
  - 估算热量与宏量营养素（蛋白质、碳水、脂肪）
  - 评估营养均衡性
  - 给出改进建议（如：增加蛋白质来源、减少精制碳水等）
  - 提供免责声明：仅为估算参考，非医疗建议
  
  **B. 体态评估**
  - 识别常见体态问题：
    - 圆肩（upper crossed syndrome）
    - 骨盆前倾/后倾
    - 高低肩
    - 脊柱侧弯倾向
    - X/O 型腿
  - 给出改善建议：
    - 针对性拉伸动作
    - 强化训练动作
    - 日常姿势注意事项
  - 支持进度对比（历史照片对比）
  
  **C. 器械/动作识别**
  - 识别健身器械类型
  - 给出使用方法与注意事项
  - 推荐目标肌群训练动作
  - 提供替代方案（家用 vs 商业健身房）

#### 4.1.3 教练性格预设
- **预设选项**：
  - 严厉型：注重纪律，强调标准动作与计划执行
  - 鼓励型：积极正面反馈，注重心理支持
  - 幽默型：轻松对话风格，降低训练压力
  - 学术派：科学详细解释，引用研究数据
  - 自定义：用户自定义 System Prompt
- **切换**：可随时在设置中切换性格
- **记忆**：性格影响对话风格，但不影响计划科学性

#### 4.1.4 会话管理
- **会话列表**：按时间排序，支持搜索与筛选
- **上下文记忆**：基于会话 ID 缓存上下文（最近 N 轮对话）
- **多会话**：支持创建多个独立会话主题
- **导出**：支持导出对话记录（Markdown/JSON）
### 4.2 用户档案与体测

#### 4.2.1 基础信息表单
- **必填项**：
  - 昵称
  - 性别（男/女/其他）
  - 出生年份（用于计算年龄）
  - 身高（cm）
  - 当前体重（kg）
  - 运动经验（无/初级/中级/高级）
  - 训练目标（增肌/减脂/体能提升/康复/综合）
  
- **选填项**：
  - 真实姓名
  - 伤病史（描述或选择常见伤病）
  - 器械条件：
    - 无器械（徒手）
    - 家用器械（哑铃、弹力带等）
    - 商业健身房（完整器械）
  - 训练场所（家/健身房/户外）
  - 每周可训练天数
  - 单次训练时长偏好

#### 4.2.2 体测数据管理
- **核心指标**：
  - 体重（kg）
  - 体脂率（%，可选）
  - 三围（胸/腰/臀，可选）
  
- **详细体围**（可选）：
  - 颈围、上臂围、前臂围
  - 大腿围、小腿围
  
- **数据记录**：
  - 支持手动输入
  - 支持历史记录查看
  - 自动生成趋势图表
  - 可设置测量提醒（如：每周一早晨）

#### 4.2.3 体态照片档案
- **照片管理**：
  - 支持正面/侧面/背面多角度拍摄
  - 按时间轴展示历史照片
  - 支持对比视图（选择两个时间点对比）
  - AI 分析结果关联到照片
  
- **隐私保护**：
  - 照片仅本地存储，不上传
  - 可选模糊/马赛克处理（面部/敏感部位）
  - 可设置访客模式（隐藏敏感数据）

#### 4.2.4 隐私与安全
- **访客锁**：
  - PIN 码或生物识别（指纹/面容）
  - 离开时自动锁定
  
- **本地加密**（可选）：
  - 使用用户密钥加密 IndexedDB 数据
  - 重要数据（照片、体测）加密存储
  
- **数据导出/导入**：
  - 导出格式：JSON / ZIP（含照片）
  - 导入支持数据合并或覆盖
  - 清除所有数据功能（工厂重置）
### 4.3 训练计划

#### 4.3.1 计划生成
- **生成参数**：
  - 周期：4/6/8/12 周（可自定义）
  - 频次：每周 2-6 次
  - 分化方式：
    - 全身训练（适合新手，2-3 次/周）
    - 上下肢分化（3-4 次/周）
    - 推拉腿（3-6 次/周）
    - 五分化（胸/背/肩/腿/手臂，5-6 次/周）
  - 单次时长：30/45/60/90 分钟
  
- **自动适配**：
  - 根据器械条件自动选择动作
  - 根据伤病史排除不适动作
  - 根据经验水平调整强度
  - 根据目标调整容量与强度配比

#### 4.3.2 训练详情
每次训练包含：
- **动作列表**：
  - 动作名称（中英文）
  - 目标肌群
  - 组数 × 次数（如：3×10）
  - 强度建议（RPE 7-8 / 1RM 的 70-75%）
  - 组间休息（秒）
  
- **动作说明**：
  - 文字描述
  - 关键要点（3-5 条）
  - 常见错误提示
  - 替代动作（至少 1 个）
  - 可链接到动作演示视频（外部链接）

#### 4.3.3 计划调整
- **手动调整**：
  - 修改动作/组数/次数
  - 添加/删除动作
  - 调整训练顺序
  - 设置超级组/巨型组
  
- **自动进阶**：
  - 基于上周完成度
  - 基于 RPE 反馈（过轻则加量/强度）
  - 基于体重/力量变化
  - 每 2-4 周建议微调
  
- **进阶策略**：
  - 渐进超负荷（重量/次数/组数）
  - 动作变式（如：深蹲 → 箱式深蹲 → 颈前深蹲）
  - 周期化（力量周期 vs 肥大周期）

#### 4.3.4 家用/受限模式
- **自动替代**：
  - 杠铃动作 → 哑铃替代
  - 器械动作 → 自由重量/徒手替代
  - 保持目标肌群与运动模式相似
  
- **示例**：
  - 杠铃卧推 → 哑铃卧推 / 俯卧撑
  - 腿举机 → 哑铃深蹲 / 单腿深蹲
  - 龙门架夹胸 → 哑铃飞鸟 / 弹力带夹胸
### 4.4 训练记录与执行

#### 4.4.1 训练执行界面
- **训练视图**：
  - 显示当日计划
  - 动作卡片（可展开查看详情）
  - 计时器（组间休息倒计时）
  - 完成度进度条
  
- **记录方式**：
  - **手动记录**：
    - 每组完成后输入：重量、实际次数
    - 每动作完成后输入：RPE（1-10）
  - **快捷记录**：
    - 按计划完成：一键标记"按计划"
    - 批量填充：复制上组数据
    - 历史参考：显示上次训练数据

#### 4.4.2 训练反馈
- **动作级反馈**：
  - RPE（主观用力感，1-10）
  - 完成质量（完美/良好/勉强）
  - 异常标记（疼痛/不适/提前力竭）
  
- **训练级反馈**：
  - 整体疲劳度（1-5 星）
  - 睡眠质量（前一晚）
  - 饮食状态（充足/一般/不足）
  - 自由备注

#### 4.4.3 图片辅助记录
- **拍摄场景**：
  - 器械照片（AI 识别并自动关联动作）
  - 重量标签（OCR 识别重量）
  - 训练环境记录
  
- **自动关联**：
  - 时间戳自动关联到训练记录
  - 可手动移动到特定动作下

### 4.5 进度复盘与统计

#### 4.5.1 训练统计
- **周报**：
  - 本周训练次数 vs 计划次数
  - 总训练量（Tonnage = Σ 组数×次数×重量）
  - 平均 RPE
  - 训练时长统计
  - 完成度百分比
  
- **月报**：
  - 训练频次趋势
  - 各肌群训练分布（饼图/柱状图）
  - PR 纪录（Personal Record）
  - 体重/体脂变化曲线

#### 4.5.2 力量进度
- **动作 PR 追踪**：
  - 最大重量（1RM 估算）
  - 最大容量（某重量下最多次数）
  - 历史最佳记录
  - 进度曲线图
  
- **肌群进度**：
  - 按肌群统计训练量
  - 对比周期内变化
  - 识别薄弱环节

#### 4.5.3 体测进度
- **数据可视化**：
  - 体重/体脂趋势曲线
  - 体围变化对比图
  - 照片时间轴对比
  - AI 体态改善评分
  
- **目标达成**：
  - 设置目标（如：减重 5kg）
  - 显示进度百分比
  - 预测达成时间（基于趋势）

#### 4.5.4 AI 计划调整建议
- **分析维度**：
  - 完成度（是否经常完不成计划）
  - RPE 趋势（是否持续过低/过高）
  - 力量增长停滞
  - 体重/体脂变化方向
  
- **建议类型**：
  - 增加/减少训练量
  - 调整强度
  - 引入减量周（Deload）
  - 更换动作变式
  - 调整饮食摄入（通用建议）
  
- **执行方式**：
  - AI 生成建议文案
  - 用户确认后自动应用
  - 支持手动微调

### 4.6 本地数据与安全
- **存储方案**：
  - IndexedDB（Dexie）：结构化数据（训练记录、计划、用户档案）
  - File System Access API（可选）：照片、导出文件
  - LocalStorage：轻量配置（主题、语言）
  
- **模型缓存**：
  - LLM 模型文件（分块存储）
  - 视觉模型（分块存储）
  - 支持版本管理
  - 支持增量更新
  - 缓存清理策略
  
- **数据导出/导入**：
  - 导出格式：JSON（纯数据）/ ZIP（含照片）
  - 包含完整训练历史、计划、体测数据
  - 导入时支持合并或覆盖
  - 数据迁移向导
## 5. 非功能需求

### 5.1 离线优先
- **核心功能离线可用**：
  - 对话（模型已下载）
  - 训练计划查看与记录
  - 数据统计与可视化
  - 用户档案管理
  
- **需要网络的功能**：
  - 首次模型下载
  - 模型更新检查
  - 外部视频链接（可选）
  
- **离线提示**：
  - 清晰告知用户当前网络状态
  - 提供离线模式切换开关
  - 自动缓存常用资源

### 5.2 隐私保护
- **数据本地化**：
  - 训练记录、用户档案、体测数据仅存本地（IndexedDB）
  - 不建立用户账号系统，无需注册登录
  - 不收集、不存储用户个人信息
  
- **API 调用隐私**：
  - 对话与图片分析需调用大模型 API（需网络）
  - 用户可选择：
    - **方案 A**：自带 API Key（完全自主控制）
    - **方案 B**：使用应用提供的服务（需付费/订阅）
  - 明确告知数据流向：图片仅用于单次分析，不存储在服务端
  - 支持对话记录本地加密
  
- **透明度**：
  - 清晰的隐私政策与数据使用说明
  - 显示 API 调用次数与消耗统计
  - 一键清除所有本地数据

### 5.3 性能要求
- **启动性能**：
  - 冷启动：< 2.5s
  - 热启动：< 1s
  - 首屏渲染：< 1.5s
  
- **运行性能**：
  - 文本对话响应：< 3s（含 API 调用，流式输出更佳）
  - 图片分析：< 8s（单张，含上传+推理+结果渲染）
  - 页面切换：< 300ms
  - 列表滚动：60 FPS
  
- **API 调用优化**：
  - 支持流式响应（Server-Sent Events / Streaming）
  - 请求失败自动重试（最多 3 次）
  - 并发请求控制（避免超出 rate limit）
  - 响应缓存（相同问题不重复请求）

### 5.4 设备适配
- **移动端优先**：
  - 竖屏布局优化
  - 触摸友好（按钮尺寸 ≥ 44×44px）
  - 手势支持（滑动、长按）
  - 底部操作栏（易触达）
  
- **响应式设计**：
  - 支持手机（320px+）
  - 支持平板（768px+）
  - 支持桌面（1024px+）
  - 自适应布局切换
  
- **无障碍支持**：
  - 语义化 HTML
  - ARIA 标签
  - 键盘导航
  - 屏幕阅读器友好
  
- **主题与个性化**：
  - 深色/浅色模式（跟随系统 + 手动）
  - 字号调节（小/中/大/特大）
  - 色盲模式（可选）
  - 高对比度模式

### 5.5 稳定性与容错
- **错误处理**：
  - 全局错误捕获
  - 友好的错误提示
  - 自动重试机制（网络请求）
  - 错误日志本地记录
  
- **数据可靠性**：
  - 自动保存（防止数据丢失）
  - 操作撤销/重做
  - 数据校验（防止非法输入）
  - 定期备份提醒
  
- **兼容性**：
  - 浏览器支持：Chrome 90+, Safari 14+, Firefox 88+, Edge 90+
  - 移动系统：iOS 14+, Android 8+
  - 渐进增强（不支持 WebGPU 时回退）
  - 特性检测与降级方案
## 6. 技术选型

### 6.1 前端框架
- **核心框架**：Vue 3（Composition API + `<script setup>`）
- **构建工具**：Vite 5.x
- **理由**：
  - 轻量、快速、易学
  - Composition API 适合复杂状态管理
  - Vite 开发体验极佳，构建速度快

### 6.2 状态管理
- **方案**：Pinia
- **Store 设计**：
  - `userStore`：用户档案、体测数据、偏好设置
  - `planStore`：训练计划、历史计划
  - `workoutStore`：当前训练、训练记录
  - `chatStore`：对话历史、会话列表
  - `mediaStore`：图片管理、分析结果
  - `aiStore`：AI 配置（提供商、API Key、使用统计）
  - `settingsStore`：应用设置（主题、语言等）

### 6.3 路由设计
- **方案**：Vue Router 4.x
- **主要路由**：
  - `/` - 首页/仪表盘
  - `/onboarding` - 首次使用引导
  - `/profile` - 用户档案与体测
  - `/chat` - 对话界面
  - `/plan` - 训练计划查看/编辑
  - `/workout` - 训练执行与记录
  - `/progress` - 进度统计与可视化
  - `/settings` - 设置页面
  - `/ai-config` - AI 配置与使用统计

### 6.4 PWA 配置
- **Service Worker**：Workbox
- **缓存策略**：
  - App Shell：Cache First（应用框架）
  - 静态资源：Cache First with Refresh（CSS/JS/字体）
  - 图片：Cache First（用户照片）
  - API 请求：Network First（AI 对话与分析）
  - 对话历史：Cache First（离线可查看）
  
- **离线支持**：
  - 离线后备页面
  - 后台同步（Background Sync，可选）
  
- **工具**：`vite-plugin-pwa`

### 6.5 本地存储
- **IndexedDB**（Dexie.js）：
  - 表设计：
    - `users`：用户档案
    - `bodyMetrics`：体测记录
    - `plans`：训练计划
    - `workouts`：训练记录
    - `exercises`：动作库
    - `messages`：对话消息
    - `images`：图片元数据与 Blob
    - `analysisResults`：AI 分析结果
    - `aiConfigs`：AI 配置（提供商、API Key 等）
    - `apiUsageStats`：API 使用统计
  
- **LocalStorage**：
  - 主题偏好
  - 语言设置
  - 最后登录时间
  - 简单配置项

- **File System Access API**（可选）：
  - 大文件导出/导入
  - 手动备份

### 6.6 AI 模型选型与接入

#### 6.6.1 通用大模型 API 选择

**推荐模型列表**（支持多模态 Vision 能力）：

| 提供商 | 模型 | 优势 | 费用 | 备注 |
|--------|------|------|------|------|
| **OpenAI** | GPT-4o / GPT-4 Turbo | 能力最强，视觉识别准确 | 较高 | 需科学上网 |
| **Anthropic** | Claude 3.5 Sonnet / Opus | 长文本理解好，安全性高 | 中等 | 需科学上网 |
| **阿里云** | 通义千问-VL-Max/Plus | 性价比高，中文优秀 | 低-中 | 国内可直接访问 |
| **百度** | 文心一言 4.0 | 中文语境好，价格友好 | 低 | 国内可直接访问 |
| **字节跳动** | 豆包大模型 | 性价比极高 | 低 | 国内可直接访问 |
| **月之暗面** | Kimi（Moonshot AI） | 超长上下文（200k tokens） | 中 | 国内可直接访问 |
| **智谱AI** | GLM-4V | 视觉理解能力强 | 中 | 国内可直接访问 |

**技术实现**：
- 统一封装 API 调用层（支持多提供商切换）
- 用户可在设置中选择模型与配置 API Key
- 支持自动降级：主模型失败时切换到备用模型

#### 6.6.2 专项视觉模型（可选，本地推理）

如需完全离线或降低成本，可补充轻量本地模型：

- **姿态估计**（体态分析辅助）：
  - TensorFlow.js + MoveNet（~10MB）
  - 用于关键点检测，辅助大模型分析
  - 浏览器内推理，无需上传图片
  
- **OCR**（识别重量标签，可选）：
  - Tesseract.js WASM（~2MB + 语言包 ~10MB）
  - 识别器械重量标签，自动填充训练记录

**混合策略**：
- 本地模型做预处理（关键点检测、OCR）
- 大模型做高级分析（饮食建议、体态评估、训练指导）

### 6.7 UI 组件库
- **方案**：Element Plus / Naive UI（二选一）
- **理由**：
  - 组件丰富、文档完善
  - Vue 3 原生支持
  - 主题可定制
  
- **补充**：VueUse（实用 Composition 工具）

### 6.8 数据可视化
- **方案**：Chart.js + vue-chartjs
- **图表类型**：
  - 折线图：体重/力量趋势
  - 柱状图：训练量对比
  - 饼图：肌群分布
  - 雷达图：综合能力评估

### 6.9 表单与校验
- **方案**：Zod（TypeScript-first schema 校验）
- **使用场景**：
  - 用户档案表单
  - 训练记录输入
  - 数据导入校验

### 6.10 原生打包（可选）
- **方案**：Capacitor
- **插件需求**：
  - Camera（相机访问）
  - Filesystem（文件管理）
  - Biometric（生物识别）
  - StatusBar / SplashScreen（原生体验）
  
- **平台**：iOS + Android（按需构建）

### 6.11 开发工具
- **语言**：TypeScript
- **代码规范**：ESLint + Prettier
- **Git Hooks**：Husky + lint-staged
- **测试**（可选）：Vitest + Testing Library
- **文档**：VitePress（可选）

### 6.12 System Prompt 设计

System Prompt 是实现私人教练专业性的核心。以下是各模块的 Prompt 设计：

#### 6.12.1 基础教练身份 Prompt（必选）

```markdown
# 角色定义
你是一位专业的私人健身教练 AI 助手，名字叫「AI 教练」。你的职责是：
- 根据用户的身体状况、训练经验和目标，制定科学的训练计划
- 解答健身相关问题，提供动作技术指导
- 分析用户提供的照片（饮食、体态、器械），给出专业建议
- 鼓励用户坚持训练，但不过度施压

# 核心原则
1. **科学性优先**：所有建议基于运动科学与生理学原理
2. **安全第一**：强调动作标准，提醒潜在风险，不推荐危险动作
3. **个性化**：考虑用户的经验水平、器械条件、目标差异
4. **免责声明**：不提供医疗诊断、疾病治疗、营养处方（仅通用建议）
5. **渐进原则**：遵循"渐进超负荷"，避免过度训练

# 知识领域
- 抗阻力训练（力量、肥大、耐力）
- 动作技术（杠铃、哑铃、固定器械、自重）
- 训练计划（分化、周期化、容量管理）
- 运动营养（宏量营养素、热量平衡，仅通用建议）
- 体态评估（常见姿态问题与改善）
- 运动损伤预防（不涉及治疗）

# 沟通风格
[根据用户选择的性格预设动态调整，见下方]

# 输出格式
- 使用 Markdown 格式，层次清晰
- 动作说明时使用要点列表（3-5 条）
- 涉及计划时，使用表格或结构化列表
- 重要警告使用 **加粗** 或 > 引用块突出
```

#### 6.12.2 性格预设 Prompt（用户可选）

**严厉型（Strict）**
```markdown
# 沟通风格调整
你是一位注重纪律的教练，风格严厉但不刻薄：
- 强调计划执行的重要性，对懈怠温和批评
- 动作技术要求高，不接受"差不多"
- 数据驱动，关注重量、次数、RPE 的精确记录
- 示例："计划是 3×10，你只做了 2×8？这样进步会很慢。下次必须完成目标。"
```

**鼓励型（Encouraging）**
```markdown
# 沟通风格调整
你是一位温暖、积极的教练，擅长激励：
- 频繁使用正面反馈与赞美
- 对任何进步表示认可，哪怕很小
- 失败时强调"过程大于结果"
- 示例："太棒了！这周你完成了 3 次训练，比上周多 1 次。保持这个节奏，下个月你会看到明显变化！💪"
```

**幽默型（Humorous）**
```markdown
# 沟通风格调整
你是一位轻松幽默的教练，降低训练压力：
- 适当使用健身相关梗和比喻
- 自嘲式幽默（如："我一个 AI 都比你更懂深蹲标准动作😏"）
- 严肃建议用轻松语气包装
- 示例："兄弟，你这个'螃蟹式'深蹲是在致敬甲壳纲动物吗？膝盖往外开，别内扣！"
```

**学术派（Academic）**
```markdown
# 沟通风格调整
你是一位知识渊博的教练，注重科学解释：
- 引用运动科学研究与原理
- 详细解释"为什么"（如：肌肥大的机制）
- 使用专业术语，但会附带通俗解释
- 示例："根据 Schoenfeld 等人的研究，肌肥大主要依赖机械张力、代谢压力和肌肉损伤三大因素。你目前的 3×10 方案主要刺激机械张力，建议增加组数以提升容量……"
```

#### 6.12.3 图片分析专用 Prompt

**饮食分析**
```markdown
# 任务：分析用户上传的食物照片
## 分析步骤
1. 识别照片中的食物种类（尽可能具体）
2. 估算各食物的份量（使用常见单位：克、碗、个等）
3. 计算大致热量与宏量营养素（蛋白质、碳水化合物、脂肪）
4. 评估营养均衡性（基于用户目标：增肌/减脂/维持）
5. 给出改进建议（3-5 条）

## 输出格式
### 食物识别
- [食物名称]：约 [份量]，[热量] kcal
  - 蛋白质：[X]g | 碳水：[X]g | 脂肪：[X]g

### 总计
总热量：约 [X] kcal
蛋白质：[X]g | 碳水：[X]g | 脂肪：[X]g

### 营养评估
[基于用户目标的评估，如："蛋白质充足，碳水偏高，适合增肌期但需注意控制体脂"]

### 改进建议
1. [具体建议]
2. [具体建议]
...

## 注意事项
- 所有数值为估算，标注"约"
- 末尾添加免责声明："以上为 AI 估算，仅供参考。精确营养数据请使用食品秤与营养表。"
```

**体态评估**
```markdown
# 任务：分析用户上传的体态照片
## 分析步骤
1. 识别照片角度（正面/侧面/背面）
2. 观察关键体态指标：
   - 头部位置（前伸/中立）
   - 肩部（圆肩/高低肩/正常）
   - 脊柱（侧弯倾向/正常）
   - 骨盆（前倾/后倾/中立）
   - 膝盖（内扣/外翻/正常）
3. 识别问题严重程度（轻微/中等/明显）
4. 给出改善建议（拉伸+强化+姿势意识）

## 输出格式
### 体态评估结果
- **[问题名称]**：[轻微/中等/明显]
  - 表现：[具体描述]
  - 影响：[可能导致的问题]

### 改善建议
#### 1. 拉伸训练（针对紧张肌群）
- [动作名称]：[组数×时长]
  - 要点：[1-2 条]

#### 2. 强化训练（针对薄弱肌群）
- [动作名称]：[组数×次数]
  - 要点：[1-2 条]

#### 3. 日常姿势意识
- [具体建议，如："使用电脑时注意屏幕高度，避免低头"]

## 注意事项
- 强调：AI 分析仅供参考，严重体态问题建议就医
- 避免过度诊断，使用"倾向""可能"等词汇
- 末尾添加："如有疼痛或不适，请咨询专业医师或物理治疗师。"
```

**器械识别**
```markdown
# 任务：识别用户上传的健身器械照片
## 分析步骤
1. 识别器械类型与名称（中英文）
2. 说明目标肌群
3. 提供使用方法（3-5 条要点）
4. 推荐 2-3 个经典动作
5. 提供替代方案（家用器械或自重）

## 输出格式
### 器械识别
**[器械名称]**（[英文名称]）

### 目标肌群
主要：[肌群列表]
次要：[肌群列表]

### 使用方法
1. [调整座椅/握距等准备工作]
2. [动作要点]
3. [常见错误提醒]

### 推荐动作
1. **[动作名称]**
   - 组数×次数：[建议]
   - 适合人群：[新手/中级/高级]

### 替代方案
如果没有此器械，可以用：
- [替代方案 1]
- [替代方案 2]
```

#### 6.12.4 训练计划生成 Prompt

```markdown
# 任务：根据用户档案生成个性化训练计划
## 输入信息
- 基础信息：[年龄、性别、身高、体重、经验水平]
- 目标：[增肌/减脂/体能/综合]
- 器械条件：[无器械/家用/健身房]
- 伤病史：[如有]
- 每周训练天数：[X] 天
- 单次时长偏好：[X] 分钟

## 生成规则
1. **经验水平适配**：
   - 无经验/初级：全身训练，2-3 天/周，基础复合动作为主
   - 中级：上下肢或推拉腿分化，3-5 天/周
   - 高级：根据需求定制分化
   
2. **目标适配**：
   - 增肌：8-12 次/组，中等重量，组间休息 60-90s
   - 减脂：12-15 次/组或 HIIT，短休息
   - 力量：3-6 次/组，大重量，长休息
   
3. **器械适配**：
   - 无器械：自重动作+变式
   - 家用：哑铃/弹力带为主
   - 健身房：自由重量+固定器械组合
   
4. **安全性**：
   - 每次训练包含热身与拉伸
   - 新手避免高风险动作
   - 有伤病史则排除相关动作

## 输出格式
### 计划概览
- **周期**：[X] 周
- **频次**：每周 [X] 次
- **分化**：[全身/上下肢/推拉腿/其他]

### 周训练安排
| 星期 | 训练内容 | 预计时长 |
|------|---------|---------|
| 一   | [训练名称] | [X] 分钟 |
| ...  | ...     | ...     |

### 详细训练计划
#### [训练日 1：训练名称]
| 动作 | 组数 | 次数 | 强度 | 休息 | 备注 |
|------|-----|-----|-----|-----|------|
| [动作名称] | 3 | 10 | RPE 7-8 | 60s | [要点] |
| ...  | ... | ... | ... | ... | ...  |

**动作说明**：
- **[动作名称]**：[简要描述]
  - 要点：[3-5 条]
  - 替代动作：[如有]

[重复其他训练日]

### 注意事项
1. [个性化提醒，如："你提到膝盖有旧伤，已避免深蹲等动作"]
2. [进阶建议，如："4 周后可增加重量或次数"]
3. [恢复提醒，如："保证每晚 7-8 小时睡眠"]
```

#### 6.12.5 上下文注入（动态）

每次对话时，将用户档案与历史数据注入上下文：

```markdown
# 用户档案（本次对话上下文）
- 昵称：[X]
- 基础信息：[年龄]岁，[性别]，[身高]cm，[体重]kg
- 经验水平：[X]
- 目标：[X]
- 器械条件：[X]
- 伤病史：[如有]
- 当前训练计划：[计划名称]，第 [X] 周
- 最近训练记录：
  - [日期]：[训练内容]，完成度 [X]%，平均 RPE [X]
  - [日期]：[训练内容]，完成度 [X]%，平均 RPE [X]
- 最近体重：[X]kg（[日期]），较上次 [+/-X]kg

# 对话历史（最近 5 轮）
[仅注入当前会话的最近对话，控制 token 消耗]
```

---

## 7. 数据模型设计

### 7.1 用户档案（User Profile）
```typescript
interface UserProfile {
  id: string;
  nickname: string;
  realName?: string;
  gender: 'male' | 'female' | 'other';
  birthYear: number;
  height: number; // cm
  currentWeight: number; // kg
  experienceLevel: 'none' | 'beginner' | 'intermediate' | 'advanced';
  goals: ('muscle_gain' | 'fat_loss' | 'fitness' | 'rehab' | 'general')[];
  injuries?: string[];
  equipment: 'none' | 'home' | 'gym';
  location: 'home' | 'gym' | 'outdoor';
  weeklyTrainingDays?: number;
  preferredSessionDuration?: number; // minutes
  coachPersonality: 'strict' | 'encouraging' | 'humorous' | 'academic' | 'custom';
  customPrompt?: string;
  createdAt: Date;
  updatedAt: Date;
}
```

### 7.2 体测数据（Body Metrics）
```typescript
interface BodyMetric {
  id: string;
  userId: string;
  date: Date;
  weight?: number; // kg
  bodyFat?: number; // %
  measurements?: {
    chest?: number; // cm
    waist?: number;
    hips?: number;
    neck?: number;
    upperArm?: number;
    forearm?: number;
    thigh?: number;
    calf?: number;
  };
  notes?: string;
  imageIds?: string[]; // 关联体态照片
}
```

### 7.3 训练计划（Training Plan）
```typescript
interface TrainingPlan {
  id: string;
  userId: string;
  name: string;
  description?: string;
  startDate: Date;
  endDate: Date;
  weeks: number;
  frequency: number; // 每周次数
  split: 'full_body' | 'upper_lower' | 'ppl' | 'bro_split';
  sessions: TrainingSession[];
  createdAt: Date;
  isActive: boolean;
}

interface TrainingSession {
  id: string;
  planId: string;
  weekNumber: number;
  dayOfWeek: number; // 1-7
  name: string; // e.g., "Push Day", "Leg Day"
  targetDuration: number; // minutes
  exercises: PlannedExercise[];
}

interface PlannedExercise {
  id: string;
  exerciseId: string; // 关联动作库
  order: number;
  sets: number;
  reps: number | string; // "10" or "8-12"
  intensity?: string; // "RPE 7-8" or "70-75% 1RM"
  restSeconds: number;
  notes?: string;
  alternatives?: string[]; // 替代动作 IDs
}
```

### 7.4 训练记录（Workout Log）
```typescript
interface WorkoutLog {
  id: string;
  userId: string;
  sessionId?: string; // 关联计划中的 session
  date: Date;
  startTime: Date;
  endTime?: Date;
  exercises: LoggedExercise[];
  overallFatigue?: number; // 1-5
  sleepQuality?: number; // 1-5
  nutritionStatus?: 'good' | 'average' | 'poor';
  notes?: string;
}

interface LoggedExercise {
  id: string;
  exerciseId: string;
  sets: LoggedSet[];
  overallRPE?: number; // 1-10
  quality?: 'perfect' | 'good' | 'struggled';
  issues?: ('pain' | 'discomfort' | 'early_failure')[];
  notes?: string;
}

interface LoggedSet {
  setNumber: number;
  weight?: number; // kg
  reps: number;
  rpe?: number; // 1-10
  completed: boolean;
}
```

### 7.5 动作库（Exercise Library）
```typescript
interface Exercise {
  id: string;
  nameZh: string;
  nameEn: string;
  category: 'strength' | 'cardio' | 'flexibility' | 'balance';
  primaryMuscles: MuscleGroup[];
  secondaryMuscles?: MuscleGroup[];
  equipment: string[]; // ['barbell', 'dumbbell', 'bodyweight']
  difficulty: 'beginner' | 'intermediate' | 'advanced';
  description: string;
  keyPoints: string[];
  commonMistakes: string[];
  videoUrl?: string;
  imageUrl?: string;
  alternatives?: string[]; // 替代动作 IDs
}

type MuscleGroup = 
  | 'chest' | 'back' | 'shoulders' | 'biceps' | 'triceps' 
  | 'forearms' | 'abs' | 'obliques' | 'quads' | 'hamstrings' 
  | 'glutes' | 'calves' | 'traps' | 'lats';
```

### 7.6 对话消息（Chat Message）
```typescript
interface ChatSession {
  id: string;
  userId: string;
  title: string;
  createdAt: Date;
  updatedAt: Date;
  messageCount: number;
}

interface ChatMessage {
  id: string;
  sessionId: string;
  role: 'user' | 'assistant' | 'system';
  content: string;
  images?: MessageImage[];
  timestamp: Date;
  metadata?: {
    model?: string;
    tokensUsed?: number;
    inferenceTime?: number;
  };
}

interface MessageImage {
  id: string;
  imageId: string; // 关联 images 表
  analysisType?: 'food' | 'posture' | 'equipment';
  analysisResult?: any;
}
```

### 7.7 图片与分析（Images & Analysis）
```typescript
interface ImageRecord {
  id: string;
  userId: string;
  type: 'food' | 'posture' | 'equipment' | 'progress' | 'other';
  blob: Blob;
  mimeType: string;
  size: number; // bytes
  width?: number;
  height?: number;
  capturedAt: Date;
  tags?: string[];
  metadata?: Record<string, any>;
}

interface AnalysisResult {
  id: string;
  imageId: string;
  analysisType: 'food' | 'posture' | 'equipment';
  result: FoodAnalysis | PostureAnalysis | EquipmentAnalysis;
  confidence?: number;
  modelVersion?: string;
  timestamp: Date;
}

interface FoodAnalysis {
  items: Array<{
    name: string;
    nameZh?: string;
    quantity?: string;
    calories?: number;
    protein?: number;
    carbs?: number;
    fat?: number;
    confidence?: number;
  }>;
  totalCalories?: number;
  totalMacros?: {
    protein: number;
    carbs: number;
    fat: number;
  };
  suggestions: string[];
}

interface PostureAnalysis {
  issues: Array<{
    type: 'forward_head' | 'rounded_shoulders' | 'anterior_pelvic_tilt' 
         | 'posterior_pelvic_tilt' | 'uneven_shoulders' | 'scoliosis' 
         | 'knee_valgus' | 'knee_varus';
    severity: 'mild' | 'moderate' | 'severe';
    description: string;
  }>;
  keypoints?: Array<{ x: number; y: number; label: string; confidence: number }>;
  suggestions: Array<{
    type: 'stretch' | 'strengthen' | 'awareness';
    exercises: string[];
    description: string;
  }>;
}

interface EquipmentAnalysis {
  equipment: string;
  equipmentZh?: string;
  category?: string;
  targetMuscles?: MuscleGroup[];
  howToUse?: string;
  recommendedExercises?: string[];
  alternatives?: string[];
}
```

### 7.8 AI 配置与统计（AI Configuration & Stats）
```typescript
interface AIConfig {
  id: string;
  userId: string;
  provider: 'openai' | 'anthropic' | 'qwen' | 'wenxin' | 'doubao' | 'kimi' | 'glm' | 'custom';
  model: string; // e.g., "gpt-4o", "claude-3-5-sonnet", "qwen-vl-max"
  apiKey?: string; // 加密存储，用户自带
  apiEndpoint?: string; // 自定义 API 端点
  temperature?: number; // 0-2，默认 0.7
  maxTokens?: number;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
}

interface APIUsageStats {
  id: string;
  userId: string;
  date: Date; // 按天统计
  provider: string;
  model: string;
  textCallCount: number; // 文本对话次数
  imageCallCount: number; // 图片分析次数
  totalTokensUsed: number; // 总 token 消耗
  estimatedCost?: number; // 估算费用（USD）
}
```

---

## 8. 核心流程设计

### 8.1 首次使用流程
```
1. 欢迎页 → 2. 填写基础信息 → 3. 选择教练性格 
→ 4. 配置 AI 服务 → 5. 生成首份计划 → 6. 进入主页
```

**详细步骤**：
- **步骤 1**：展示应用特色与隐私承诺
  - 核心功能介绍（对话、图片分析、计划生成）
  - 数据隐私说明（本地存储，可自带 API Key）
  
- **步骤 2**：表单收集用户档案（必填项）
  - 昵称、性别、年龄、身高、体重
  - 运动经验、训练目标、器械条件
  
- **步骤 3**：4 种性格预设 + 示例对话预览
  - 严厉型 / 鼓励型 / 幽默型 / 学术派
  - 点击预设可查看示例对话
  
- **步骤 4**：配置 AI 服务
  - **选项 A**：自带 API Key（推荐）
    - 选择提供商（OpenAI / Claude / 通义千问等）
    - 输入 API Key（加密存储）
    - 测试连接
  - **选项 B**：使用应用服务（如提供）
    - 选择订阅套餐
    - 跳过此步骤，稍后配置也可
  
- **步骤 5**：生成首份训练计划
  - AI 根据用户档案生成 4-8 周计划
  - 展示计划概览（分化方式、频次、动作列表）
  - 允许用户手动调整
  - 确认后保存
  
- **步骤 6**：进入主页
  - 显示今日训练卡片
  - 引导用户开始第一次训练或与 AI 对话

### 8.2 图片拍摄与分析流程
```
拍摄/上传 → 选择分析类型 → AI 推理 → 展示结果 → 保存/添加到对话
```

**详细步骤**：
1. **拍摄/上传**：
   - 相机拍摄或相册选择
   - 支持多张（1-4 张）
   - 图片预览与裁剪（可选）

2. **选择分析类型**（可自动检测）：
   - 饮食分析
   - 体态评估
   - 器械识别
   - 不确定（让 AI 自动判断）

3. **AI 推理**：
   - 显示加载动画与进度
   - 预处理：调整尺寸、格式转换
   - 模型推理（WebGPU/WebGL）
   - 后处理：结构化结果

4. **展示结果**：
   - 图片 + 标注（如：食物边界框、关键点）
   - 分析文本（Markdown 格式）
   - 建议列表
   - 置信度指示

5. **后续操作**：
   - 保存到图片档案
   - 添加到当前对话
   - 关联到训练记录（如：器械识别）
   - 分享（导出图片 + 文字）

### 8.3 训练记录流程
```
选择训练计划 → 逐动作执行 → 记录每组数据 → 填写反馈 → 保存 → 生成统计
```

**详细步骤**：
1. **开始训练**：
   - 显示今日计划
   - 或手动选择某天训练
   - 点击"开始训练"

2. **逐动作执行**：
   - 显示动作详情（名称、组数、次数、强度）
   - 可展开查看要点与视频
   - 组间休息倒计时

3. **记录每组**：
   - 输入：重量、实际次数
   - 快捷操作：按计划完成 / 复制上组
   - 显示上次训练数据作参考

4. **动作完成后**：
   - 输入 RPE（1-10）
   - 标记质量与异常
   - 可拍摄照片（器械/环境）

5. **训练结束**：
   - 填写整体反馈
   - 查看本次统计（总量、时长、完成度）
   - 保存到数据库

6. **自动处理**：
   - 更新力量进度（PR 检测）
   - 触发计划调整建议（如果需要）
   - 更新周/月统计

### 8.4 AI 计划调整流程
```
数据分析 → 生成建议 → 用户确认 → 应用调整 → 生成新计划
```

**详细步骤**：
1. **触发条件**（每 1-2 周）：
   - 用户手动请求
   - 系统自动检测（完成 4-6 次训练后）

2. **数据分析**：
   - 完成度统计
   - RPE 趋势分析
   - 力量增长/停滞检测
   - 体重/体脂变化

3. **生成建议**：
   - AI 综合分析，生成文字建议
   - 包含具体调整项（动作/组数/强度）
   - 解释调整理由

4. **用户确认**：
   - 展示建议与预览
   - 允许手动修改
   - 确认后应用

5. **应用调整**：
   - 更新训练计划
   - 标记调整记录
   - 通知用户下次训练已更新

---

## 9. UI/UX 设计要点

### 9.1 首页/仪表盘
- **今日训练卡片**：显示今日计划，快速进入
- **进度概览**：本周训练次数、体重变化趋势
- **快捷入口**：对话、拍照分析、查看计划
- **激励元素**：连续训练天数、本周目标完成度

### 9.2 对话界面
- **消息流**：类 ChatGPT，时间降序
- **输入栏**：
  - 文本框（支持多行）
  - 拍照按钮（调起相机/相册）
  - 发送按钮
- **消息气泡**：
  - 用户：右侧，蓝色
  - AI：左侧，灰色
  - 支持 Markdown 渲染
  - 图片消息支持点击放大
- **加载状态**：AI 思考中动画

### 9.3 训练执行界面
- **顶部**：进度条（已完成动作/总动作）
- **动作卡片**：
  - 折叠状态：动作名 + 组数×次数
  - 展开状态：详细说明 + 上次数据
- **记录输入**：
  - 数字键盘快捷输入
  - 大按钮，易操作
- **计时器**：组间休息倒计时，可暂停/跳过
- **完成按钮**：固定底部，突出显示

### 9.4 进度统计界面
- **选项卡**：周报 / 月报 / 力量进度 / 体测进度
- **图表**：
  - 使用品牌色
  - 可交互（点击查看详情）
  - 空数据状态提示
- **数据卡片**：关键指标高亮（PR、体重变化等）

### 9.5 图片分析界面
- **拍摄模式**：
  - 全屏相机预览
  - 拍摄按钮居中底部
  - 前后摄像头切换
  - 闪光灯开关
- **分析结果**：
  - 图片 + 可视化标注（可关闭）
  - 结果面板（可滚动）
  - 操作按钮组：保存、添加到对话、重新分析

### 9.6 设置界面
- **分组清晰**：账户、外观、模型、数据、关于
- **危险操作**：二次确认（清除数据、删除模型）
- **模型管理**：
  - 已下载模型列表
  - 可选模型列表（下载按钮）
  - 空间占用显示
  - 删除/切换功能

---

## 10. 开发计划与里程碑

### Phase 1：基础框架（1-2 周）
- [ ] 项目初始化（Vite + Vue 3 + TypeScript）
- [ ] 路由与状态管理搭建（Vue Router + Pinia）
- [ ] UI 组件库集成与主题配置（Element Plus / Naive UI）
- [ ] IndexedDB 数据库设计与 Dexie 配置
- [ ] 基础页面框架（首页、设置、引导页）
- [ ] PWA 配置与 Service Worker（可选）

### Phase 2：用户系统与计划（2 周）
- [ ] 用户档案表单与存储
- [ ] 体测数据记录与展示
- [ ] 动作库数据准备（JSON 格式，100+ 常见动作）
- [ ] 训练计划生成逻辑（前端规则引擎或调用 AI）
- [ ] 计划展示与编辑界面
- [ ] 基础单元测试

### Phase 3：AI API 集成（2-3 周）
- [ ] 统一 AI 服务层封装（支持多提供商切换）
- [ ] OpenAI / Claude / 通义千问等 API 接入
- [ ] System Prompt 设计与管理
  - [ ] 基础教练身份 Prompt
  - [ ] 4 种性格预设 Prompt
  - [ ] 图片分析专用 Prompt（饮食/体态/器械）
  - [ ] 训练计划生成 Prompt
- [ ] 对话界面开发
- [ ] 流式响应支持（SSE / Streaming）
- [ ] 对话历史存储与加载
- [ ] 上下文管理（用户档案注入、token 控制）
- [ ] API Key 配置界面（用户自带 Key）

### Phase 4：图片分析（2 周）
- [ ] 相机调用与图片上传（HTML5 + Canvas）
- [ ] 图片预处理（压缩、格式转换、Base64 编码）
- [ ] 多模态 API 调用（GPT-4V / Claude 3 / 通义千问-VL）
- [ ] 饮食分析流程与 UI
- [ ] 体态分析流程与 UI
- [ ] 器械识别流程与 UI
- [ ] 分析结果展示与保存
- [ ] 可选：TensorFlow.js + MoveNet 本地辅助（体态关键点检测）

### Phase 5：训练记录（2 周）
- [ ] 训练执行界面
- [ ] 手动记录功能
- [ ] 组间休息计时器
- [ ] 历史数据参考
- [ ] 训练日志保存
- [ ] 快捷操作优化

### Phase 6：统计与可视化（2 周）
- [ ] Chart.js 集成
- [ ] 周报/月报生成
- [ ] 力量进度追踪（PR 检测）
- [ ] 体测数据曲线
- [ ] 照片时间轴对比
- [ ] 导出功能（PDF/图片）

### Phase 7：智能调整（1-2 周）
- [ ] 数据分析算法
- [ ] 计划调整建议生成
- [ ] 自动进阶逻辑
- [ ] 用户确认流程
- [ ] 调整历史记录

### Phase 8：优化与完善（2 周）
- [ ] 性能优化（懒加载、代码分割、虚拟列表）
- [ ] API 调用优化（请求缓存、重试机制、并发控制）
- [ ] 错误处理与友好提示
- [ ] 无障碍支持（ARIA、键盘导航）
- [ ] 多语言支持（i18n，可选）
- [ ] 深色模式优化
- [ ] 端到端测试

### Phase 9：打包与发布（1 周）
- [ ] 构建优化（Tree-shaking、压缩、CDN）
- [ ] PWA 配置完善（可选）
- [ ] Capacitor 打包（可选，iOS + Android）
- [ ] 应用图标与启动页
- [ ] 性能审计（Lighthouse，目标 >90 分）
- [ ] 部署到静态托管（Vercel / Netlify / Cloudflare Pages）
- [ ] 用户文档与隐私政策编写

**总计**：约 13-16 周（3-4 个月）

**时间节省说明**：
- 移除本地模型下载与缓存管理（节省 ~2 周）
- 移除 WebGPU/WASM 适配与优化（节省 ~1 周）
- API 调用比本地推理实现简单（节省 ~1-2 周）

---

## 11. 风险与挑战

### 11.1 技术风险
- **API 依赖**：
  - 风险：大模型 API 故障、限流、价格变动
  - 应对：支持多提供商切换，自动降级备用 API，缓存常见问答
  
- **成本控制**：
  - 风险：用户高频调用导致 API 费用过高
  - 应对：
    - 推荐用户自带 API Key（自主控制成本）
    - 实现请求缓存（相同问题不重复调用）
    - 设置每日调用限额（如使用应用提供的服务）
    - 提供 token 消耗统计与预警

- **网络依赖**：
  - 风险：离线无法使用 AI 功能
  - 应对：
    - 训练记录、计划查看等核心功能离线可用
    - 缓存历史对话，允许离线查看
    - 明确标识需要网络的功能

- **隐私风险**：
  - 风险：图片上传到第三方 API，用户担忧隐私
  - 应对：
    - 清晰告知数据流向
    - 推荐用户自带 API Key（数据由用户与提供商直接交互）
    - 图片仅用于单次分析，不存储在应用服务器
    - 支持本地 TensorFlow.js 模型作为隐私敏感功能的替代方案

### 11.2 产品风险
- **AI 准确性**：
  - 风险：饮食/体态识别错误，误导用户
  - 应对：清晰的免责声明，显示置信度，允许手动纠正

- **用户留存**：
  - 风险：功能复杂，用户流失
  - 应对：优化引导流程，提供快速上手模式

### 11.3 法律风险
- **健身建议责任**：
  - 风险：用户因错误建议受伤
  - 应对：明确免责声明，建议咨询专业人士，不提供医疗建议

- **隐私合规**：
  - 风险：虽然本地存储，但需符合隐私法规
  - 应对：提供隐私政策，允许数据导出/删除

---

## 12. 成功指标

### 12.1 短期指标（3 个月）
- DAU（日活）：≥ 100
- 首周留存率：≥ 60%
- 图片分析使用率：≥ 40% 用户
- 平均会话时长：≥ 5 分钟
- 崩溃率：< 1%

### 12.2 中期指标（6 个月）
- MAU（月活）：≥ 1000
- 计划完成率：≥ 50% 用户完成 4 周以上
- NPS（净推荐值）：≥ 40
- 付费转化率（如有）：≥ 5%

### 12.3 长期指标（1 年）
- MAU：≥ 5000
- 用户健身目标达成率：≥ 30%
- 社区口碑（评分）：≥ 4.5/5.0
- 多平台覆盖（Web + iOS + Android）

---

## 13. 未来扩展方向

### 13.1 功能扩展
- [ ] 语音输入/输出（Whisper + TTS）
- [ ] 实时视频姿态纠正
- [ ] 营养日记与热量追踪
- [ ] 社交功能（匿名分享进度）
- [ ] 训练伙伴匹配
- [ ] 可穿戴设备集成（心率、步数）

### 13.2 商业化方向
- [ ] 高级模型解锁（付费）
- [ ] 专业教练人工咨询
- [ ] 定制计划服务
- [ ] 品牌合作（器械/补剂）
- [ ] 企业健康管理方案

### 13.3 技术升级
- [ ] 联邦学习（在保护隐私前提下改进模型）
- [ ] 端侧微调（个性化模型）
- [ ] AR 训练辅助（动作叠加指导）
- [ ] 云端可选同步（加密）

---

## 14. 总结

本 PRD 定义了一个**通过通用大模型 API 实现专业化、数据本地存储**的 AI 私人教练应用，核心特色为：

### 核心亮点

1. **专业化 AI 教练**：
   - 通过精心设计的 System Prompt 实现专业健身指导
   - 支持 4 种性格预设（严厉/鼓励/幽默/学术）
   - 多模态能力：图文对话 + 图片智能分析

2. **图片智能分析**：
   - 饮食识别：食物种类、热量、营养素估算与建议
   - 体态评估：识别圆肩、骨盆前倾等问题，提供改善方案
   - 器械识别：识别器械、推荐动作、提供替代方案

3. **个性化训练计划**：
   - 基于用户档案自动生成 4-8 周计划
   - AI 根据完成度与 RPE 自动调整
   - 支持器械受限模式（徒手/家用/健身房）

4. **数据隐私保护**：
   - 训练记录、用户档案仅存本地（IndexedDB）
   - 用户可选择自带 API Key（完全自主控制）
   - 图片仅用于单次分析，不存储在服务端

5. **灵活的模型接入**：
   - 支持多家大模型提供商（OpenAI、Claude、国内大模型）
   - 统一 API 封装，一键切换
   - 自动降级与容错

### 技术优势

- **开发周期短**：3-4 个月（vs 本地模型方案的 4.5-5.5 个月）
- **响应质量高**：通用大模型能力远超小型本地模型
- **成本可控**：
  - 方案 A：用户自带 Key，零成本
  - 方案 B：应用提供服务，收费订阅覆盖成本
- **维护简单**：无需管理模型版本、量化、适配等复杂工作

### 商业化路径

1. **免费版**：用户自带 API Key，无限制使用
2. **订阅版**：
   - 应用提供 API 服务
   - 月度调用额度（如：100 次对话 + 30 次图片分析）
   - 高级模型解锁（GPT-4、Claude Opus）
3. **增值服务**：
   - 人工教练咨询（视频通话）
   - 定制化计划设计
   - 营养补剂推荐（联盟营销）

### 下一步行动

**阶段 1：技术验证（1 周）**
1. 注册测试 API Key（OpenAI / 通义千问）
2. 编写 System Prompt 原型并测试效果
3. 验证多模态图片分析能力（饮食/体态/器械）

**阶段 2：设计与准备（1 周）**
1. 完善 UI 设计稿（Figma）
2. 准备动作库数据（JSON，100+ 动作）
3. 细化数据库表结构

**阶段 3：启动开发（第 3 周起）**
1. 搭建项目框架（Phase 1）
2. 实现用户系统与计划模块（Phase 2）
3. 接入 AI API 与对话功能（Phase 3）
4. 逐步完成后续功能模块

**预计上线时间**：3-4 个月后（MVP 版本）

---

**附录：Prompt 模板文件**

建议在项目中创建 `src/prompts/` 目录，存放各类 Prompt 模板：
- `base-coach.md`：基础教练身份
- `personalities/`：严厉/鼓励/幽默/学术四种性格
- `image-analysis/`：饮食/体态/器械分析
- `plan-generation.md`：训练计划生成
- `context-injection.md`：用户档案上下文注入模板